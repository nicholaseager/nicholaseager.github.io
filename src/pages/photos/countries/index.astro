---
import Page from "../../../layouts/Page.astro";
import { getCollection, getEntry, getEntries } from "astro:content";
import Grid from "../../../components/ui/Grid";
import HeroCard from "../../../components/ui/HeroCard";

const photoLocations = await getCollection("photoLocations");

// Filter to only get country locations (those without country/region format in id)
const countries = await Promise.all(
  photoLocations
    .filter((l) => !l.data.id.includes("/"))
    .map((l) => l.data)
    .map(async (data) => {
      return {
        ...data,
        photos: (await getEntries(data.photos)).map((p) => p.data),
        previewPhoto: (await getEntry(data.previewPhoto)).data,
      };
    })
);
---

<Page
  title="Places"
  description="Sometimes a single photo is all you need to tell a story. Browse my most unique stories."
>
  <div class="space-y-8">
    <Grid>
      {
        countries.map((country) => (
          <HeroCard
            title={country.title}
            subtitle={`${country.photos.length} photo${country.photos.length !== 1 ? "s" : ""}`}
            imagePath={country.previewPhoto.slug}
            href={`/photos/countries/${country.id}`}
          />
        ))
      }
    </Grid>
  </div>
</Page>

---
import { getCollection } from "astro:content";

import PhotoGrid from "../../../../../components/photos/PhotoGrid";
import Page from "../../../../../layouts/Page.astro";
import GallerySEO from "../../../../../seo/GallerySEO.astro";

export async function getStaticPaths() {
  const photoLocations = await getCollection("photoLocations");

  // Filter to only get region locations (those with country/region format in id)
  const locations = photoLocations
    .filter((l) => l.data.id.includes("/"))
    .map((l) => l.data);

  // Transform locations into Astro path params
  const uniquePaths = locations.map((location) => {
    const [country, region] = location.id.split("/");
    return {
      params: { country, region },
      props: {
        ...location,
      },
    };
  });

  return uniquePaths;
}

const { title, description, photos, previewImage } = Astro.props;
---

<Page title={title} description={description}>
  <PhotoGrid client:visible photos={photos} />
  <GallerySEO
    title={title}
    description={description}
    images={photos}
    image={previewImage}
  />
</Page>

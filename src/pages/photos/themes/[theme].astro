---
import { getCollection } from "astro:content";
import Page from "../../../layouts/Page.astro";
import PhotoGrid from "../../../components/photos/PhotoGrid";
import GallerySEO from "../../../seo/GallerySEO.astro";
import { mergePhotoTagsMetadata } from "../../../utils/photo-collections";

export async function getStaticPaths() {
  const photos = await getCollection("photos");
  const themesMetadata = await getCollection("photoThemes");

  const themes = themesMetadata
    .map((t) => t.id)
    .map((id) => mergePhotoTagsMetadata(id, photos, themesMetadata));

  return themes.map((theme) => ({
    params: { theme: theme.id },
    props: {
      title: theme.title,
      description: theme.description,
      photos: theme.photos,
      primaryImage: theme.previewImage,
    },
  }));
}

type Props = {
  title: string;
  description: string;
  photos: string[];
  primaryImage: string;
};

const { title, description, photos, primaryImage } = Astro.props;
---

<Page title={title} description={description}>
  <PhotoGrid client:visible photos={photos} />
  <GallerySEO
    title={title}
    description={description}
    images={photos}
    image={primaryImage}
  />
</Page>

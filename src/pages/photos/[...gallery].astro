---
import { type CollectionEntry, getCollection } from "astro:content";
import Gallery from "../../layouts/Gallery.astro";

export async function getStaticPaths() {
  const galleries = await getCollection("galleries");
  return galleries.map((gallery) => ({
    params: { gallery: gallery.id },
    props: gallery,
  }));
}
type Props = CollectionEntry<"galleries">;

const gallery = Astro.props;
const photos = await getCollection("photos");
const parts = gallery.id.split("/");
const filteredPhotos = photos
  .filter((photo) => {
    if (parts[0] === "themes") {
      return photo.data.tags.includes(parts[1]);
    }

    const locationTags = parts.slice(1);
    return locationTags.every((t) => photo.data.tags.includes(t));
  })
  .map((p) => p.data);
---

<Gallery
  title={gallery.data.title}
  description={gallery.data.description}
  content={gallery.data.content}
  date={gallery.data.date}
  modified_date={gallery.data.modified_date}
  photos={filteredPhotos}
  previewPhoto={filteredPhotos[0]}
/>

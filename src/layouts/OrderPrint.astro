---
import Layout from "../layouts/Layout.astro";
import RoomDisplaySwiper from "../components/photos/RoomDisplaySwiper";
import OrderForm from "../components/form/OrderForm.astro";
import Text from "../components/ui/Text";
import ColumnLayout from "../components/ui/ColumnLayout.astro";
import type { CollectionEntry } from "astro:content";
import MediaContainer from "../components/containers/MediaContainer.astro";
import TextContainer from "../components/containers/TextContainer.astro";
import LinkButton from "../components/ui/LinkButton";
import YouTubeIcon from "/src/assets/icons/YouTube.svg";
import ExternalLink from "/src/assets/icons/ExternalLink.svg";
import SimilarPhotos from "../components/photos/SimilarPhotos.astro";

type Props = CollectionEntry<"photos">["data"];

const {
  path,
  description,
  tags,
  "youtube-id": youtubeId,
  "darkroom-id": darkroomId,
} = Astro.props;

const authorName = "Nicholas Eager";
const organizationName = "Nicholas Eager Photography";
const currentYear = new Date().getFullYear();

// TODO
const pathParts = path.split("/");
const title = pathParts[pathParts.length - 1]
  .split("-")
  .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
  .join(" ");
const location = pathParts
  .slice(2, -1) // Skip "photos" and "countries" prefix, and exclude the filename
  .map((part) =>
    part
      .split("-")
      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
      .join(" ")
  )
  .join(" / ");
---

<Layout>
  <section>
    <MediaContainer>
      <ColumnLayout>
        <RoomDisplaySwiper client:load artworkPath={path} />
        <div class="w-full space-y-2">
          <div>
            <Text variant="h2">
              {title}
            </Text>
            <Text variant="caption">
              {location}
            </Text>
            <Text variant="caption">
              By <a href="/about">{authorName}</a>
            </Text>
            <Text variant="caption">
              <b>Â© {currentYear}</b>
              {organizationName}
            </Text>
          </div>

          <Text variant="caption">
            {description}
          </Text>

          {
            youtubeId && (
              <LinkButton
                variant="secondary"
                size="sm"
                href={`https://www.youtube.com/watch?v=${youtubeId}`}
                target="_blank"
                rel="noopener noreferrer"
              >
                <div class="flex flex-row gap-2 align-middle items-center">
                  <YouTubeIcon /> Watch the video behind the photo
                </div>
              </LinkButton>
            )
          }

          {
            darkroomId ? (
              <div class="mt-4 p-4 space-y-4 bg-background-alt rounded-lg">
                <Text variant="body">
                  Order a print to share the story in your own home.
                </Text>
                <LinkButton
                  variant="primary"
                  size="lg"
                  href={`https://nicholaseagerphoto.darkroom.com/products/${darkroomId}`}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <div class="flex flex-row gap-4 align-middle items-center">
                    Order Print <ExternalLink width={18} height={18} />
                  </div>
                </LinkButton>
              </div>
            ) : (
              <OrderForm />
            )
          }
        </div>
      </ColumnLayout>
    </MediaContainer>
  </section>

  <section class="prose prose-slate max-w-none">
    <TextContainer>
      <h2>Licensing</h2>
      <p>
        Interested? I offer a few different types of licenses for my photos and
        footage. Read more about
        <a href="/how-to-use-my-art" class="text-blue-600 hover:text-blue-800"
          >how to use my art</a
        >.
      </p>

      <p>
        If you have any comments, questions, or other inquiries, please
        <a href="/contact" class="text-blue-600 hover:text-blue-800"
          >contact me</a
        >
        separately.
      </p>

      <h2>You Might Also Like</h2>
      <p>
        Want a different photo?
        <a href="/photos" class="text-blue-600 hover:text-blue-800"
          >Browse more photos</a
        >
        or look below to find what you're looking for.
      </p>
    </TextContainer>
  </section>

  <section>
    <MediaContainer>
      <SimilarPhotos tags={tags} />
    </MediaContainer>
  </section>
</Layout>
